# 데이터 가드 구현

소유자: 쏘니

<aside>
🛡️ 데이터 가드 구현

- Primary DB : 나의 영문 이니셜 DB(SHM DB)
- Standby DB : sbdb2
</aside>

---

# primary db 구성 - 영문 이니셜 DB

1. 오라클 접속을 위한 환경 변수가 들어있는 .bash_profile을 수정한다.
    
    ```sql
    # ORACLE_SID 가 PROD로 되어있기 때문에 shm 으로 변경하기
    
    [shm:~]$ vi .bash_profile
    -------------------
    :%s/PROD/shm/g
    -------------------
    [shm:~]$ source .bash_profile
    ```
    
    - 변경 전
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled.png)
        
    - 변경 후
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%201.png)
        

1. DB를 생성할 디렉토리를 생성한다.
    
    ```sql
    [shm:~]$ mkdir -p /u01/app/oracle/oradata/shm
    [shm:~]$
    [shm:~]$ ls -ld /u01/app/oracle/oradata/shm
    drwxr-xr-x 2 oracle oinstall 4096  3월 14 16:50 /u01/app/oracle/oradata/shm
    [shm:~]$
    [shm:~]$ cd /u01/app/oracle/oradata/shm
    [shm:shm]$
    [shm:shm]$ mkdir disk1 disk2 disk3 disk4 disk5
    [shm:shm]$
    [shm:shm]$ ls
    disk1  disk2  disk3  disk4  disk5
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%202.png)
    

1. parameter file 을 만든다.
    1. parameter file을 생성해야 nomount 단계로 올라갈 수 있다. 
    
    ```sql
    #1. parameter file이 있는 위치로 이동하여, 
    -- spfileshm.ora와 initshm.ora가 없는지 확인(있으면 rm으로 지워버리기)
    [shm:shm]$ cd $ORACLE_HOME/dbs
    [shm:dbs]$
    [shm:dbs]$ pwd
    /u01/app/oracle/product/11.2.0/dbhome_1/dbs
    [shm:dbs]$
    [shm:dbs]$ ls
    arch1_7_1163599733.dbf  hc_DBUA0.dat  hc_shm.dat    initSBDB.ora  orapwSBDB      peshm_PROD_0  peshm_shm_0
    arch1_8_1163599733.dbf  hc_PROD.dat   hc_shm2.dat   lkPROD        parameter.sql  peshm_SBDB_0
    arch1_9_1163599733.dbf  hc_SBDB.dat   init.ora      lkSBDB        peshm_DBUA0_0  peshm_orcl_0
    demobld.sql             hc_orcl.dat   initPROD.ora  orapwPROD     peshm_DUMMY_0  peshm_shm2_0
    
    #2. 없으면 parameter file (pfile) 생성해주기
    [shm:dbs]$ 
    vi $ORACLE_HOME/dbs/initshm.ora
    
    ------------------------아래 내용 넣기---------------------------
    db_name = shm
    compatible=11.2.0.1.0
    
    sga_target = 256M
    
    undo_management = AUTO
    undo_tablespace = UNDOTBS
    
    processes = 100
    
    remote_login_passwordfile = EXCLUSIVE
     
    control_files = (/u01/app/oracle/oradata/shm/disk1/ctrl1.ctl ,
                     /u01/app/oracle/oradata/shm/disk2/ctrl2.ctl ,
                     /u01/app/oracle/oradata/shm/disk3/ctrl3.ctl)
                     
                     ~~/u01/app/oracle/flash_recovery_area/ctl4.ctl  )~~
    -> 이건 만들어 두면 나중에 불편하기 때문에 지워버림
    
    #3. cat으로 initshm.ora 내용 출력하여 내용이 잘 들어갔는지 확인
    
    [shm:dbs]$ cat $ORACLE_HOME/dbs/initshm.ora
    
    db_name = shm
    compatible=11.2.0.1.0
    
    sga_target = 256M
    
    undo_management = AUTO
    undo_tablespace = UNDOTBS
    
    processes = 100
    
    remote_login_passwordfile = EXCLUSIVE
    
    control_files = (/u01/app/oracle/oradata/shm/disk1/ctrl1.ctl ,
                     /u01/app/oracle/oradata/shm/disk2/ctrl2.ctl ,
                     /u01/app/oracle/oradata/shm/disk3/ctrl3.ctl)
    
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%203.png)
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%204.png)
    
2. instance 를 nomount 로 올린다.
    
    ```sql
    #1. 아래와 같이 sys에 접속하기 
    [shm:~]$ sqlplus / as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 16:57:37 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to an idle instance.
    
    #2. startup nomount로 올립니다.(pfile을 사용해서 instance 구성)
    shm SYS > startup nomount pfile=$ORACLE_HOME/dbs/initshm.ora
    ORACLE instance started.
    
    Total System Global Area  267825152 bytes
    Fixed Size                  1335924 bytes
    Variable Size              92278156 bytes
    Database Buffers          167772160 bytes
    Redo Buffers                6438912 bytes
    
    #3. DB STARTUP 단계 확인하기 
    shm SYS > select instance_name, status
      2     from v$instance;
    
    INSTANCE_NAME    STATUS
    ---------------- ------------
    shm              STARTED
    
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%205.png)
    

1. create database 스크립트를 수행한다.
    - database 를 생성한다는것은 어떠한 파일들을 생성하면 db 가 생성되는
    것인가 ?
        1. data file
        2. controlfile
        3. redo log file
        4. parameter file
        5. archive log file
        6. password file
        
    - database 를 수동으로 생성하는 스크립트를 수행하면 위의 파일중 3가지
    가 생성된다.
        1. data file
        2. controlfile
        3. redo logfile
    
    - DB 수동으로 생성하기
        - SI DBA가 DB를 생성할 때 정석과 같은 스크립트
    
    ```sql
    create database shm
    user sys identified by oracle
    user system identified by oracle
    datafile '/u01/app/oracle/oradata/shm/disk1/system01.dbf' 
    size 100M autoextend on maxsize unlimited extent management local
    sysaux 
    datafile '/u01/app/oracle/oradata/shm/disk2/sysaux01.dbf' 
    size 50M autoextend on maxsize unlimited
    default temporary tablespace temp
    tempfile '/u01/app/oracle/oradata/shm/disk3/temp01.dbf' 
    size 50M autoextend on maxsize unlimited
    undo tablespace undotbs
    datafile '/u01/app/oracle/oradata/shm/disk4/undotbs01.dbf' 
    size 50M autoextend on maxsize unlimited
    logfile 
    group 1 ('/u01/app/oracle/oradata/shm/disk4/redoG1M1.rdo',
            '/u01/app/oracle/oradata/shm/disk5/redoG1M2.rdo') size 100M,
    group 2 ('/u01/app/oracle/oradata/shm/disk4/redoG2M1.rdo',
            '/u01/app/oracle/oradata/shm/disk5/redoG2M2.rdo') size 100M,
    group 3 ('/u01/app/oracle/oradata/shm/disk4/redoG3M1.rdo',
            '/u01/app/oracle/oradata/shm/disk5/redoG3M2.rdo') size 100M,
    group 4 ('/u01/app/oracle/oradata/shm/disk4/redoG4M1.rdo',
            '/u01/app/oracle/oradata/shm/disk5/redoG4M2.rdo') size 100M,
    group 5 ('/u01/app/oracle/oradata/shm/disk4/redoG5M1.rdo',
             '/u01/app/oracle/oradata/shm/disk5/redoG5M2.rdo') size 100M;
             
             
    =============================
    ** autoextend on maxsize unlimited **
    최초의 사이즈는 50M 이지만, 디스크 공간이 허용할 때 까지 무한하게 늘어날 수 있게 해주는 것. 자동으로 늘어나게 됨! 
    따라서 테이블 스페이스 공간 부족 에러가 발생하지 않을 것(앞으로 계속! 디스크가 허용한다면!!)
    
    ** log file member를 2개 씩 구성을 해두는데, 디스크를 다른 곳에 각각 생성 
    (디스크가 깨져도 문제가 생기지 않도록) **
    ```
    
    - DB를 생성하면, data file, control file, redo log file이 함께 생성되었기 때문에 DB가 OPEN으로 올라오게 됨. (startup 되기 위해 필요한 모든 파일이 존재하기 때문)
    
    ```sql
    shm SYS > 
    select instance_name, status
      from v$instance;
    
    INSTANCE_NAME    STATUS
    ---------------- ------------
    PROD             OPEN
    
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%206.png)
    
    ⇒ DBCA로 만든다면 Password를 입력하는 창이 나올 것이지만, 수동으로 생성하기 때문에 직접 이곳에 입력해줘야함 
    
2. **data dictionary 를 생성하는 스크립트를 수행한다.**
    1. data dictionary와 oracle에 필요한 필수 패키지 같은 것이 설치됨. 
    
    ```sql
    shm SYS >
    @$ORACLE_HOME/rdbms/admin/catalog.sql
    
    @$ORACLE_HOME/rdbms/admin/catproc.sql
    
    connect system/oracle
    
    shm SYSTEM >
    @$ORACLE_HOME/sqlplus/admin/pupbld.sql 
    ```
    
    - 첫번째 스크립트 종료 캡쳐 사진
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%207.png)
        
    - 두번째 스크립트 종료 캡쳐 사진
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%208.png)
        
    - 세번째 스크립트 종료 캡쳐 사진
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%209.png)
        

1. shm DB 에 운영 DATA 생성
    1. - scott 계정 생성하고  demobld 스크립트를 수행한다.
        
        ```sql
        shm SYSTEM > connect / as sysdba
        Connected.
        shm SYS >
        shm SYS > create user scott
          identified by tiger;   2
        
        User created.
        
        shm SYS > grant dba to scott;
        
        Grant succeeded.
        
        shm SYS > connect scott/tiger
        Connected.
        shm SCOTT >
        shm SCOTT > @demobld -- emp 테이블과 dept 테이블 구성
        
        alter session set nls_Date_format='RR/MM/DD';
        
        Session altered.
        
        ... 이하생략 
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2010.png)
        
    
    b.  sqlplus 에서 vi 편집기를 실행할수 있도록 설정한다.
    
    ```sql
    [shm:~]$ cd $ORACLE_HOME/sqlplus/admin
    [shm:admin]$
    [shm:admin]$ vi glogin.sql
    [shm:admin]$
    [shm:admin]$ pwd
    /u01/app/oracle/product/11.2.0/dbhome_1/sqlplus/admin
    
    --------아래의 내용 넣거나 있는지 확인---------
    define _editor='vi'
    set sqlprompt "_connect_identifier _user > "
    ----------------------------------------------
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2011.png)
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2012.png)
    

# Standby DB 구성 - SBDB2 DB 구성

Primary DB에서 Standby DB로 archive log file을 보내야하기 때문에 archive log 상태로 설정해주는 것 

■ Standby  DB 구성 방법

1. standby DB 생성시 필요한 환경을 Primary DB 에 설정해준다.
2. Primary DB 의 파라미터 파일을 수정한다.
3. Standby DB 를 위한 Directory 를 생성
4. 모든 datafile ,temp file 을 standby DB 로 전달
5. Primary DB 에서 standby DB 를 위한 controlfile 을 생성한후
전달한다.

---

1. standby DB 생성시 필요한 환경을 Primary DB 에 설정해준다.
    - DataGuard 를 구성하기 위해서 Primaryh DB 쪽에 필요한 환경설정 3가지
        
        1)  Password file 인증방법이어야한다.
        
        ```sql
        shm SYS > show parameter remote_login_passwordfile
        
        NAME                                 TYPE        VALUE
        ------------------------------------ ----------- ------------------------------
        remote_login_passwordfile            string      EXCLUSIVE
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2013.png)
        
        2) Archive log mode 여야한다.
        
        ```sql
          SQL> archive log list
          SQL> shutdown immediate
          SQL> startup mount
          SQL> alter database archivelog;
          SQL> alter database open;
          SQL> archive log list
          
          -----------------------------
          
        
        shm SYS > archive log list
        Database log mode              No Archive Mode
        Automatic archival             Disabled
        Archive destination            /u01/app/oracle/product/11.2.0/dbhome_1/dbs/arch
        Oldest online log sequence     3
        Current log sequence           7
        
        shm SYS > shutdown immediate
        Database closed.
        Database dismounted.
        ORACLE instance shut down.
        
        shm SYS > startup mount
        ORACLE instance started.
        
        Total System Global Area  267825152 bytes
        Fixed Size                  1335924 bytes
        Variable Size              92278156 bytes
        Database Buffers          167772160 bytes
        Redo Buffers                6438912 bytes
        Database mounted.
        
        shm SYS > alter database archivelog;
        
        Database altered.
        
        shm SYS > alter database open;
        
        Database altered.
        
        shm SYS >
        shm SYS > archive log list
        Database log mode              Archive Mode
        Automatic archival             Enabled
        Archive destination            /u01/app/oracle/product/11.2.0/dbhome_1/dbs/arch
        Oldest online log sequence     3
        Next log sequence to archive   7
        Current log sequence           7
        
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2014.png)
        
        3) Force logging 이 활성화 되어 있어야한다.( 무조건 log 정보가 생기게 하겠다)
        
        ⇒ 그래야 모든 log 정보가 넘어갈 수 있음. 
        
        PRIMARY DB에서 수행한 모든 DML문장들이 LOG에 기록이 되고 이 정보를 ARCHIVE LOG 에 기록되어 STANDBY DB에 넘기게 됨
        
        ```sql
        db 전체에 대해서 강제로 log 정보가 생성되도록 설정해줘야한다.
        
         SQL>  alter database force logging;  
        
         SQL>  
         alter database add supplemental log data
           (primary key, unique  index) columns;
        
                 * primary db 에서 수행한 dml 문장들이 저장이된다.
        
          SQL> alter system archive log current;
        
          SQL> alter system switch logfile;
        
          SQL> select name from v$archived_log;
        
          SQL> select FORCE_LOGGING from v$database;
          
          
        ----------- 수행해보기 ----------
        
        shm SYS > alter database force logging;
        
        Database altered.
        
        shm SYS > alter database add supplemental log data
           (primary key, unique  index) columns;  2
        
        Database altered.
        
        shm SYS >
        shm SYS > alter system archive log current;
        
        System altered.
        
        shm SYS > alter system switch logfile;
        
        System altered.
        
        shm SYS > select name from v$archived_log;
        
        NAME
        --------------------------------------------------------------------------------
        /u01/app/oracle/product/11.2.0/dbhome_1/dbs/arch1_7_1163610068.dbf
        /u01/app/oracle/product/11.2.0/dbhome_1/dbs/arch1_8_1163610068.dbf
        
        shm SYS > select FORCE_LOGGING from v$database;
        
        FOR
        ---
        YES
        
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2015.png)
        
        ⇒ YES 가 떠야 정상 
        

1. Primary DB 의 파라미터 파일을 수정한다.
    
    ```sql
    $ cd $ORACLE_HOME/dbs
    $ vi initshm.ora
    ======================= 내용 추가하기 ========================
     # 맨 아래쪽에 아래의 내용들을 추가한다.
     # 아래 내용들을 왼쪽에 공백 없이 딱 붙여서 추가하기 
     # 지금부터는 data guard 를 구성하기 위한 파라미터들을 설정 
      
    db_unique_name=shm
    
     # standby db 쪽의 db 이름도 shm 일것이므로 
     # primary db 쪽에 db_unique_name 을 shm 라고 셋팅해야한다. 
     
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    standby_file_management=auto
    
     # primary db 쪽에서 테이블 스페이스를 생성하면
     # standby db 쪽에서도 똑같은 테이블 스페이스가 자동으로 
     # 만들어지게 하는 파라미터 
     # e.g 판교에서 테이블 스페이스 생성하면 원주에서도 동일한 테이블 스페이스가 생성되어야함
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
    db_file_name_convert='/home/oracle/SBDB2','/u01/app/oracle/oradata/shm'
                
    # Primary db쪽에는 data file 이 아래의 위치에 있고 
     /u01/app/oracle/oradata/shm   <---- 이 위치에 있고
    
     # Standby db 쪽에는 data file 이 아래의 위치에 있다는 것을 오라클에게 알려줌
     /home/oracle/SBDB2   <--------- 이 위치에 있다는것을 알려줌
     
     항상 primary db가 뒤에 있고 앞에 첫 인자에 standby DB가 있음 
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
    log_file_name_convert='/home/oracle/SBDB2','/u01/app/oracle/oradata/shm'
    
    # Primary db쪽에는 redo log file 이 
     /u01/app/oracle/oradata/shm   <---- 이 위치에 있고
    
    # Standby db 쪽에는 redo log file  이
     /home/oracle/SBDB2   <--------- 이 위치에 있다는것을 알려줌 */
    
    redo log file의 위치도 오라클에 알려주는 것 
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
    log_archive_dest_1='location=/home/oracle/shm/arch valid_for=(all_logfiles,all_roles)'
    
    # primary DB 쪽에서 생성될 archive log file의 위치를 지정해주는 것
    -- primary DB 쪽의 archive log file이 어디에 생성되어 있는지 알려주는 코드 (위치 지정)
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~저장하고 나가기~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    [shm:~]$ mkdir shm
    mkdir: shm 디렉토리를 만들 수 없습니다: 파일이 존재합니다
    [shm:~]$
    [shm:~]$ ls -ld shm
    drwxr-xr-x 2 oracle oinstall 4096  1월 18 12:13 shm
    [shm:~]$
    [shm:~]$ mkdir arch
    
    $ pwd
    /home/oracle/shm/arch
    -- 이제 이 위치에 archive log file이 생성될 것
    
    만약에 이미 있으면 arch 디렉토리만 생성해주면 됨
    
    그리고 다시 $ORACLE_HOME/dbs 밑에 있는 initshm.ora를 엽니다.
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
    # primary db 쪽에 아카이브 로그 파일의 위치를 하나 더 생성함
    # 한줄로 넣어주기 
    log_archive_dest_2='service=SBDB2 LGWR SYNC AFFIRM valid_for=(online_logfiles,primary_role)' 
       
     -- service를 쓰고 SBDB2라는 tns 별칭을 사용하여 
     -- tns 별칭에 해당하는 DB 쪽에 archive log file이 넘어가는 것 
     primary db쪽에 log file 위치 하나 더 생성함
    
    이제 standby DB 쪽에 archive log file이 실시간으로 넘어가게 됨 
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    만약에 STANDBY DB였던 것이 PRIMARY DB가 되는 상황이 되면 
    아래의 주석달린 두 코드가 필요함
    그래서 주석을 달아서 혹시 몰라서 넣어둠.
    언제 두 DB 들이 switch 될지 모르기 때문 
     # standby db 쪽에 생성할 아카이브 로그파일의 위치 
    
    -----아래의 두 코드 ------
    #fal_server=SBDB2
    #fal_client=shm
    -------------------------
    
    # 나중에 primary db 가 standby db 가 될수있기 때문에 미리 적어놓은 파라미터
    
    ~~~~~~~~~~~~~~~~~~~~~~다했으면 저장하고 나오기! ~~~~~~~~~~~~~~~~~~~~~~~
    파라미터 파일 구성 끝!
    ```
    
    ```sql
    db_name = shm
    compatible=11.2.0.1.0
    
    sga_target = 256M
    
    undo_management = AUTO
    undo_tablespace = UNDOTBS
    
    processes = 100
    
    remote_login_passwordfile = EXCLUSIVE
    
    control_files = (/u01/app/oracle/oradata/shm/disk1/ctrl1.ctl ,
                     /u01/app/oracle/oradata/shm/disk2/ctrl2.ctl ,
                     /u01/app/oracle/oradata/shm/disk3/ctrl3.ctl)
    
    db_unique_name=shm
    standby_file_management=auto
    db_file_name_convert='/home/oracle/SBDB2','/u01/app/oracle/oradata/shm'
    log_file_name_convert='/home/oracle/SBDB2','/u01/app/oracle/oradata/shm'
    log_archive_dest_1='location=/home/oracle/shm/arch valid_for=(all_logfiles,all_roles)'
    log_archive_dest_2='service=SBDB2 LGWR SYNC AFFIRM valid_for=(online_logfiles,primary_role)'
    
    #fal_server=SBDB2
    #fal_client=shm
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2016.png)
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2017.png)
    

1. Standby DB 를 위한 Directory 를 생성
    1. primary DB의 datafile과 control file을 standby DB에 받기만 하면 됨(단, 원격 SCP로!)
    
    ```sql
    [shm:~]$ mkdir -p /home/oracle/SBDB2
    [shm:~]$
    [shm:~]$ ls -ld /home/oracle/SBDB2
    drwxr-xr-x 2 oracle oinstall 4096  3월 14 17:55 /home/oracle/SBDB2
    ```
    
    ⇒ standby DB 쪽에 데이터 파일과 control file을 받을 디렉토리 생성
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2018.png)
    

1. 모든 datafile ,temp file 을 standby DB 로 전달
    1. 반드시 db를 정상 종료한 다음 수행해야함 
        
        ```sql
        shm SYS > shutdown immediate
        Database closed.
        Database dismounted.
        ORACLE instance shut down.
        
        # 디렉토리를 통째로 넘길 것이기 때문에 -rp옵션을 사용한다. 
        [shm:~]$ cp -rp /u01/app/oracle/oradata/shm/* /home/oracle/SBDB2
        [shm:~]$
        [shm:~]$ cd /home/oracle/SBDB2
        [shm:SBDB2]$
        [shm:SBDB2]$ ls
        disk1  disk2  disk3  disk4  disk5
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2019.png)
        

1. Primary db 쪽에 아카이브 로그 파일과 flasback database log 가 저장될 위치를 생성하시오 ~
    1. flashback database 를 가능하게 해주는 
    
    ```sql
    [shm:~]$ mkdir -p /home/oracle/shm/arch   <--- 아카이브 로그파일 위치
    [shm:~]$ mkdir -p /home/oracle/shm/flash  <--  flashback database log 위치
    
    [shm:~]$ cd shm
    [shm:shm]$
    [shm:shm]$ ls
    arch     emp1.csv   emp2.csv  emp4.csv  emp6.csv  emp8.csv  emp_backup.csv  movies.csv   ratings.csv  users.csv
    emp.csv  emp10.csv  emp3.csv  emp5.csv  emp7.csv  emp9.csv  flash           movies2.csv  report.csv
    [shm:shm]$
    [shm:shm]$ ls -ld arch
    drwxr-xr-x 2 oracle oinstall 4096  3월 14 17:58 arch
    [shm:shm]$
    [shm:shm]$ ls -ld flash
    drwxr-xr-x 2 oracle oinstall 4096  3월 14 17:58 flash
    
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2020.png)
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2021.png)
    

1. standby db 쪽에 아카이브 로그 파일과 flasback database log 가
저장될 위치를 생성하시오 ~
    
    ```sql
    $ mkdir -p /home/oracle/SBDB2/arch
    $ mkdir -p /home/oracle/SBDB2/flash
    
    ------------- 수행 --------------
    [shm:~]$ mkdir -p /home/oracle/SBDB2/arch
    [shm:~]$ mkdir -p /home/oracle/SBDB2/flash
    [shm:~]$
    [shm:~]$ cd SBDB2
    [shm:SBDB2]$
    [shm:SBDB2]$ ls
    arch  disk1  disk2  disk3  disk4  disk5  flash
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2022.png)
    

- Primary db ----------------------> standby db 넘겨줘야할 파일
    1. 모든 datafile 들
    2. tempfile
    3. redo log file
    4. standby 용 controlfile --------------->

1. shm DB 를 mount 로 올리고  standby 용 controlfile 을 생성한다. - PRIMARY DB에서 생성
    
    ```sql
    shm SYS > startup mount
    ORACLE instance started.
    
    Total System Global Area  267825152 bytes
    Fixed Size                  1335924 bytes
    Variable Size              92278156 bytes
    Database Buffers          167772160 bytes
    Redo Buffers                6438912 bytes
    Database mounted.
    
    shm SYS > alter database create standby controlfile
      as '$HOME/physical.ctl' reuse;  
    
    Database altered.
    
    -- reuse를 사용하여 동일한 control file명이 존재하면 덮어쓰라는 의미이다. 
    -- $HOME = HOME 밑의 ORACLE = /home/oracle
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2023.png)
    

1. Primary DB 쪽에서 생성한 standby 용 controlfile 을 Standby 쪽으로 넘겨준다.
    
    ```sql
    $ cp $HOME/physical.ctl /home/oracle/SBDB2/disk1/ctrl1.ctl
    $ cp $HOME/physical.ctl /home/oracle/SBDB2/disk2/ctrl2.ctl
    $ cp $HOME/physical.ctl /home/oracle/SBDB2/disk3/ctrl3.ctl
    
    ---------------------- 수행 및 확인 ------------------------
    [shm:~]$ cp $HOME/physical.ctl /home/oracle/SBDB2/disk1/ctrl1.ctl
    [shm:~]$ cp $HOME/physical.ctl /home/oracle/SBDB2/disk2/ctrl2.ctl
    [shm:~]$ cp $HOME/physical.ctl /home/oracle/SBDB2/disk3/ctrl3.ctl
    
    [shm:~]$ cd SBDB2
    [shm:SBDB2]$
    
    [shm:SBDB2]$ cd disk1
    [shm:disk1]$
    [shm:disk1]$ ls
    ctrl1.ctl  system01.dbf
    [shm:disk1]$
    [shm:disk1]$ cd ..
    [shm:SBDB2]$
    [shm:SBDB2]$ cd disk2
    [shm:disk2]$
    [shm:disk2]$ ls
    ctrl2.ctl  sysaux01.dbf
    [shm:disk2]$
    [shm:disk2]$ cd ..
    [shm:SBDB2]$
    [shm:SBDB2]$ cd disk3
    [shm:disk3]$
    [shm:disk3]$ ls
    ctrl3.ctl  temp01.dbf
    
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2024.png)
    
    반드시 controlfile은 primary DB에서 standby db용 controlfile을 생성해줘야한다. 
    
    이제 standby db에는 datafile와 control file이 존재함 
    

1. 리스너가 인식하고 있는 서비스가 무엇인지 확인한다.
    1. 동적 서비스 등록을 정적 서비스 등록으로 변경합니다.
    2. 동적 서비스 등록은 11g의 경우 PMON이 그 이후는 LREG가 직접 리스너에게 서비스를 등록해주는데, 느림….
    3. 그래서 정적 서비스 등록으로 해주어 빠르게 등록되도록 한다. 
    4. 만약 동적 서비스 등록이면 데이터 가드가 잘 안될수도 있을 걸..? 
    
    ```sql
    [shm:~]$ lsnrctl status
    
    LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 14-MAR-2024 18:10:31
    
    Copyright (c) 1991, 2009, Oracle.  All rights reserved.
    
    Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.19.51)(PORT=1521)))
    STATUS of the LISTENER
    ------------------------
    Alias                     LISTENER
    Version                   TNSLSNR for Linux: Version 11.2.0.1.0 - Production
    Start Date                14-MAR-2024 15:28:41
    Uptime                    0 days 2 hr. 41 min. 49 sec
    Trace Level               off
    Security                  ON: Local OS Authentication
    SNMP                      OFF
    Listener Parameter File   /u01/app/oracle/product/11.2.0/dbhome_1/network/admin/listener.ora
    Listener Log File         /u01/app/oracle/diag/tnslsnr/edydr1p0/listener/alert/log.xml
    Listening Endpoints Summary...
      (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.19.51)(PORT=1521)))
      (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
    Services Summary...
    Service "+ASM" has 1 instance(s).
      Instance "+ASM", status READY, has 1 handler(s) for this service...
    Service "PROD" has 2 instance(s).
      Instance "PROD", status UNKNOWN, has 1 handler(s) for this service...
      Instance "PROD", status READY, has 1 handler(s) for this service...
    Service "SBDB" has 2 instance(s).
      Instance "SBDB", status UNKNOWN, has 1 handler(s) for this service...
      Instance "SBDB", status READY, has 1 handler(s) for this service...
    Service "shm" has 1 instance(s).
      Instance "shm", status READY, has 1 handler(s) for this service...
    The command completed successfully
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
    [shm:~]$ cd $ORACLE_HOME/network/admin
    [shm:admin]$
    [shm:admin]$ ls -l listener.ora
    -rw-r--r-- 1 oracle oinstall 436  3월 14 15:28 listener.ora
    [shm:admin]$
    [shm:admin]$ mv listener.ora listener.bak
    [shm:admin]$
    [shm:admin]$ ls listener.*
    listener.bak
    
    # 이름 변경해두고(backup 본 만들어두고 새롭게 listener.ora를 구성할 것)
    [shm:admin]$ vi listener.ora
    [shm:admin]$
    
    -------------------------아래의 내용 입력 ---------------------------
    LISTENER =
      (DESCRIPTION_LIST =
        (DESCRIPTION =
          (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.19.51)(PORT = 1521))
          (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
        )
      )
    
    SID_LIST_LISTENER=
      (SID_LIST =
        (SID_DESC =
          (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
          (SID_NAME=shm)
         )
        (SID_DESC =
          (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1)
          (SID_NAME=SBDB2)
         )
       )
     -------------------------------------------------------------
       
    [shm:admin]$ ls
    listener.bak  listener.ora  samples  shrept.lst  sqlnet.ora  tnsnames.ora
    
     $ lsnrctl  stop
     $ lsnrctl  start
    
    [shm:admin]$ lsnrctl start
    
    LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 14-MAR-2024 18:18:37
    
    Copyright (c) 1991, 2009, Oracle.  All rights reserved.
    
    Starting /u01/app/oracle/product/11.2.0/dbhome_1/bin/tnslsnr: please wait...
    
    TNSLSNR for Linux: Version 11.2.0.1.0 - Production
    System parameter file is /u01/app/oracle/product/11.2.0/dbhome_1/network/admin/listener.ora
    Log messages written to /u01/app/oracle/diag/tnslsnr/edydr1p0/listener/alert/log.xml
    Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.19.51)(PORT=1521)))
    Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
    
    Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.19.51)(PORT=1521)))
    STATUS of the LISTENER
    ------------------------
    Alias                     LISTENER
    Version                   TNSLSNR for Linux: Version 11.2.0.1.0 - Production
    Start Date                14-MAR-2024 18:18:37
    Uptime                    0 days 0 hr. 0 min. 0 sec
    Trace Level               off
    Security                  ON: Local OS Authentication
    SNMP                      OFF
    Listener Parameter File   /u01/app/oracle/product/11.2.0/dbhome_1/network/admin/listener.ora
    Listener Log File         /u01/app/oracle/diag/tnslsnr/edydr1p0/listener/alert/log.xml
    Listening Endpoints Summary...
      (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.19.51)(PORT=1521)))
      (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
    Services Summary...
    Service "SBDB2" has 1 instance(s).
      Instance "SBDB2", status UNKNOWN, has 1 handler(s) for this service...
    Service "shm" has 1 instance(s).
      Instance "shm", status UNKNOWN, has 1 handler(s) for this service...
    The command completed successfully
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2025.png)
    
    ⇒ lsnrctl start 하자마자  바로 service가 등록되는 것을 확인할 수 있다.
    
    리스너가 서비스 2개를 잘 인식하는지 확인 완료 
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2026.png)
    
    ![스크린샷 2024-03-14 182010.png](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/%25EC%258A%25A4%25ED%2581%25AC%25EB%25A6%25B0%25EC%2583%25B7_2024-03-14_182010.png)
    

1. tnsnames.ora 파일의 아래의 내용을 추가한다.
    
    ```sql
    [shm:~]$ cd $ORACLE_HOME/network/admin
    [shm:admin]$ vi tnsnames.ora
    
    ----------------- 중복된 것이 없는지 확인하고 넣기 -------------------
    shm =
      (DESCRIPTION =
        (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.19.51)(PORT = 1521))
        (CONNECT_DATA =
          (SERVER = DEDICATED)
          (SERVICE_NAME = shm)
        )
      )
    
    SBDB2 =
      (DESCRIPTION =
        (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.19.51)(PORT = 1521))
        (CONNECT_DATA =
          (SERVER = DEDICATED)
          (SERVICE_NAME = SBDB2)
        )
      )
    
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2027.png)
    

1. shm 와 SBDB2 를 위한 패스워드 파일 생성
    1. 원격에서 유저를 통해서 sys에 접속하려면 반드시 password file이 있어야함. 
    2. sys유저가 listener 를 통해서 원격에서 접속하려면 반드시 password file이 있어야함. 
    3. 지역이 서로 멀기 때문에 원격으로 접속해야하는 것. 
    4. 서로 sys유저로 접속하기 위해서 password file 생성
    5. sys유저의 password를 변경하기 위해서 password file을 생성하기도 하지만 위와 같은 이유로 생성하기도 함 
    
    ```sql
    [shm:admin]$ cd $ORACLE_HOME/dbs
    [shm:dbs]$
    [shm:dbs]$ pwd
    /u01/app/oracle/product/11.2.0/dbhome_1/dbs
    [shm:dbs]$
    [shm:dbs]$ orapwd file=orapwSBDB2 password=oracle ignorecase=Y
    [shm:dbs]$ orapwd file=orapwshm password=oracle ignorecase=Y
    [shm:dbs]$ ls orapw*
    orapwPROD  orapwSBDB  orapwSBDB2  orapwshm
    ```
    
    - 설명 :  패스워드파일을 생성하는 이유는 원격에서 리스너 통해서 sys 유져로 접속하려고 생성
    - orapwd : 패스워드 파일을 생성하는 유틸리티
    - ignorecase=Y 는 패스워드 oracle 을 대문자로 쓰든 소문자로 쓰든 상관없이 접속하게 하겠다.
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2028.png)
    

1. 위에서 구성한 nework 설정이 정상인지 확인하시오 ~
    1. 리스너를 통해서 sys유저로 접속해보는 것 (대소문자 상관 없이 접속해보기)
    2. 4개를 접속해보고 아무 문제가 없으면 지금까지 잘 설정 한 것 
    
    ```sql
     $ sqlplus sys/oracle@prod as sysdba
     $ sqlplus sys/ORACLE@prod as sysdba
     $ sqlplus sys/oracle@sbdb as sysdba
     $ sqlplus sys/ORACLE@sbdb as sysdba
     
     
     --------------해보기 --------------
     
    [shm:~]$ sqlplus sys/oracle@prod as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:24:33 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    prod SYS > exit
    Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    [shm:~]$
    [shm:~]$ sqlplus sys/ORACLE@prod as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:24:41 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    prod SYS > exit
    Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    [shm:~]$
    [shm:~]$ sqlplus sys/oracle@sbdb as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:24:51 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    sbdb SYS > exit
    Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    [shm:~]$
    [shm:~]$ sqlplus sys/ORACLE@sbdb as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:24:58 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    sbdb SYS > exit
    Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2029.png)
    

1. `.bash_profile` 을 열어서 shm 와 SBDB2 로 접근하기 위한 alias 를 생성한다.
    
    ```sql
    [shm:~]$ vi .bash_profile
    
    ----------------아래의 내용 추가 --------------
    alias shm='export ORACLE_SID=shm'
    alias sbdb2='export ORACLE_SID=SBDB2'
    -----------------------------------------------
    [shm:~]$ source .bash_profile
    [shm:~]$
    [shm:~]$ shm
    [shm:~]$
    [shm:~]$ sbdb2
    [SBDB2:~]$
    [SBDB2:~]$ shm
    [shm:~]$
    [shm:~]$ sbdb2
    
       $ prod
       $ sqlplus / as  sysdba
    
      SQL> select instance_name, status from v$instance;
      -- 이미 mount여도 내렸다 올리기 
      SQL> shutdown immediate
      SQL> startup mount 
    
    ----- 실행해보기 -----
    
    [SBDB2:~]$ shm
    [shm:~]$
    [shm:~]$ sqlplus / as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:28:04 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    shm SYS >
    shm SYS > select instance_name, status from v$instance;
    
    INSTANCE_NAME    STATUS
    ---------------- ------------
    shm              MOUNTED
    
    shm SYS > shutdown immediate
    ORA-01109: database not open
    
    Database dismounted.
    ORACLE instance shut down.
    shm SYS > startup mount
    ORACLE instance started.
    
    Total System Global Area  267825152 bytes
    Fixed Size                  1335924 bytes
    Variable Size              92278156 bytes
    Database Buffers          167772160 bytes
    Redo Buffers                6438912 bytes
    Database mounted.
    shm SYS > select instance_name, status from v$instance;
    
    INSTANCE_NAME    STATUS
    ---------------- ------------
    shm              MOUNTED
    
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2030.png)
    
    ![스크린샷 2024-03-14 182619.png](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/%25EC%258A%25A4%25ED%2581%25AC%25EB%25A6%25B0%25EC%2583%25B7_2024-03-14_182619.png)
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2031.png)
    

1. SBDB 용 파라미터 파일 구성 - 새로이 생성하는 것
    
    ```sql
    [PROD:~]$ cd $ORACLE_HOME/dbs
    [PROD:dbs]$
    [PROD:dbs]$ vi initSBDB2.ora
    
    -------------------- 아래의 내용 추가 ---------------------
    
    compatible=11.2.0.1.0
    control_files = (/home/oracle/SBDB2/disk1/ctrl1.ctl ,
                     /home/oracle/SBDB2/disk2/ctrl2.ctl ,
                     /home/oracle/SBDB2/disk3/ctrl3.ctl )
    db_block_size=8192
    db_name=shm
    service_names=SBDB2
    global_names=true
    job_queue_processes=10
    open_cursors=500
    processes=100
    remote_login_passwordfile='EXCLUSIVE'
    sga_max_size=120M
    sga_target=120M
    undo_management='AUTO'
    undo_tablespace='UNDOTBS'
    db_recovery_file_dest_size=4G
    db_recovery_file_dest=/home/oracle/SBDB2/flash
    db_unique_name=SBDB2
    standby_file_management=auto
    db_file_name_convert='/u01/app/oracle/oradata/shm','/home/oracle/SBDB2'
    log_file_name_convert='/u01/app/oracle/oradata/shm','/home/oracle/SBDB2'
    log_archive_dest_1='location=/home/oracle/SBDB2/arch valid_for=(all_logfiles, all_roles)'
    log_archive_dest_2='service=shm LGWR SYNC AFFIRM valid_for=(online_logfiles, primary_role)'
    #standby_archive_dest=/home/oracle/SBDB2/arch
    #recovery_parallelism=4
    fal_server=shm
    fal_client=SBDB2
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2032.png)
    
    **※ standby DB 쪽에서 반드시 활성화 되어져야하는 파라미터**
    
    1. fal_server=shm (Primary DB)----> 아카이브 로그파일을 보내줘야하는 DB
    2. fal_client=SBDB2(Standby DB)----> 아카이브 로그파일을 받아야하는 DB
    
    ```sql
    	shm --------------------------------------> SBDB2
    								 archive  log  file
    ```
    

1. standby 용 redo log file 을 shm 와 SBDB2 에서 각각 생성
    1. shm DB
        
        ```sql
        alter database add standby logfile
         '/u01/app/oracle/oradata/shm/disk1/standby01.log' size 10m;
        
        alter database add standby logfile
         '/u01/app/oracle/oradata/shm/disk1/standby02.log' size 10m;
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2033.png)
        
    2. SBDB2 DB
        
        ```sql
        [PROD:~]$ sbdb
        [SBDB:~]$
        [SBDB:~]$ sqlplus / as sysdba
        
        SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 16:06:43 2024
        
        Copyright (c) 1982, 2009, Oracle.  All rights reserved.
        
        Connected to an idle instance.
        
        SBDB SYS > startup
        ORACLE instance started.
        
        Total System Global Area  125538304 bytes
        Fixed Size                  1334968 bytes
        Variable Size              75497800 bytes
        Database Buffers           41943040 bytes
        Redo Buffers                6762496 bytes
        Database mounted.
        Database opened.
        SBDB SYS >
        SBDB SYS > 
        
        alter database add standby logfile
         '/home/oracle/SBDB2/disk1/standby01.log' size 10m;
        
        alter database add standby logfile
         '/home/oracle/SBDB2/disk1/standby02.log' size 10m;
        
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2034.png)
        

1. shm 와 SBDB2 의 PMON 이 잘 떠있는지 확인한다.
    1. 원주에 있는 db는 이제 항상 복구만 하고 있는 db가 되는 것
        
        ```sql
        [SBDB2:~]$ ps -ef | grep pmon
        oracle    5297     1  0 10:22 ?        00:00:05 asm_pmon_+ASM
        oracle   23728     1  0 15:59 ?        00:00:01 ora_pmon_PROD
        oracle   23898     1  0 16:11 ?        00:00:01 ora_pmon_SBDB
        oracle   25180     1  0 18:28 ?        00:00:00 ora_pmon_shm
        oracle   25271     1  0 18:34 ?        00:00:00 ora_pmon_SBDB2
        oracle   25331 29987  0 18:35 pts/4    00:00:00 grep pmon
        
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2035.png)
        

### ----- 여기서 부터가 중요 (sbdb2 를 복구모드로 변환하는 작업)

1. standby 디비인 SBDB2 를 복구모드로 변환한다.
    
    ```sql
     - SBDB2 에서 수행한다.
    
      SQL> shutdown  immediate
      SQL> startup  mount
    
      SQL> alter database flashback on;
    
     -- MRP(Media Recovery Process) 가 떠있는지 확인하기위해 아래의 작업수행
    
      SQL> select process, status from v$managed_standby;
    
                     <---- MRP 가 지금은 아직 안뜬다.
    
     -- 복구모드로 변환하는 명령어를 수행한다.
    
      SQL> recover managed standby database disconnect;
    
    -- 다시 MRP 가 떠있는지 확인한다. 
      SQL> select process, status from v$managed_standby;
    
                     <---- MRP 가 지금 뜬다.
                     
    ~~~~~~ 실습해보기 ~~~~~~~~
    
    SBDB2 SYS > shutdown immediate
    Database closed.
    Database dismounted.
    ORACLE instance shut down.
    SBDB2 SYS >
    SBDB2 SYS > startup mount
    ORACLE instance started.
    
    Total System Global Area  125538304 bytes
    Fixed Size                  1334968 bytes
    Variable Size              75497800 bytes
    Database Buffers           41943040 bytes
    Redo Buffers                6762496 bytes
    Database mounted.
    SBDB2 SYS >
    SBDB2 SYS > select process, status from v$managed_standby;
    
    PROCESS   STATUS
    --------- ------------
    ARCH      CONNECTED
    ARCH      CONNECTED
    ARCH      CONNECTED
    ARCH      CONNECTED
    
    SBDB2 SYS >
    SBDB2 SYS > recover managed standby database disconnect;
    Media recovery complete.
    SBDB2 SYS >
    SBDB2 SYS > select process, status from v$managed_standby;
    
    PROCESS   STATUS
    --------- ------------
    ARCH      CONNECTED
    ARCH      CONNECTED
    ARCH      CONNECTED
    ARCH      CONNECTED
    MRP0      WAIT_FOR_LOG
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2036.png)
    

1. shm 와 SBDB2 쪽에서 각각 아래의 명령어를 수행해서 datafile 의 갯수가 똑같은지 확인 (각각 3개씩 존재하는지 확인해야함!!)
    1. SBDB2 DB
        
        ```sql
        SBDB2 SYS > select name from v$datafile;
        
        NAME
        --------------------------------------------------------------------------------
        /home/oracle/SBDB2/disk1/system01.dbf
        /home/oracle/SBDB2/disk2/sysaux01.dbf
        /home/oracle/SBDB2/disk4/undotbs01.dbf
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2037.png)
        
    2. shm DB
        
        ```sql
        [SBDB2:~]$ shm
        [shm:~]$
        [shm:~]$ sqlplus / as sysdba
        
        SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:39:15 2024
        
        Copyright (c) 1982, 2009, Oracle.  All rights reserved.
        
        Connected to:
        Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
        With the Partitioning, OLAP, Data Mining and Real Application Testing options
        
        shm SYS >
        shm SYS > select name from v$datafile;
        
        NAME
        --------------------------------------------------------------------------------
        /u01/app/oracle/oradata/shm/disk1/system01.dbf
        /u01/app/oracle/oradata/shm/disk2/sysaux01.dbf
        /u01/app/oracle/oradata/shm/disk4/undotbs01.dbf
        
        ```
        
        ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2038.png)
        

1. shm 쪽 db 를 올리고 테이블스페이스를 생성해서 standby db 로 넘어가서 반영되는지 확인한다.
    1. 주의 : SBDB2는 mount 상태여야함 
    
    ```sql
     - shm
    
    SQL> alter database open;
    
    SQL> 
    create tablespace ts9000
      datafile '/u01/app/oracle/oradata/shm/disk2/ts900.dbf' size 10m;
      
    ~~~~~~~~~~~~~~~~~~~~~~~~ 실습 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
    shm SYS > alter database open;
    
    Database altered.
    
    shm SYS >
    shm SYS > create tablespace ts9000
      datafile '/u01/app/oracle/oradata/shm/disk2/ts900.dbf' size 10m;  2
    
    Tablespace created.
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2039.png)
    

1. 아래의 작업을 양쪽에서 각각 수행한다.
    
    ```sql
      - shm
    
        select name from v$datafile;
    
      - SBDB2  
     
        select name from v$datafile;
    
        
    # 계속 안뜨면 MRP가 뜨는지 확인해보기 
    
    SQL> select process, status from v$managed_standby;
    
    PROCESS   STATUS
    --------- ------------
    ARCH	  CLOSING
    ARCH	  CONNECTED
    ARCH	  CONNECTED
    ARCH	  CONNECTED
    MRP0	  WAIT_FOR_LOG   --->  아카이브된 리두정보를 standby db 적용
    RFS	  IDLE    (Remote File Server) ---> Primary db 로 부터
    RFS	  IDLE                             리두정보를 수신하고 리두를
    RFS	  IDLE                             standby db 의 리두로그와
                                               아카이브 리두로그에 직접기록
                                               하는 프로세서 
    
    - primary db
    
    SQL> 
    select process, status from v$managed_standby;
    
    PROCESS   STATUS
    --------- ------------
    ARCH	  CLOSING
    ARCH	  CONNECTED
    ARCH	  CLOSING
    ARCH	  CLOSING
    LGWR	  WRITING
    
    그래도 안만들어지면 shm DB에서 alter system switch log file을 해주어 
    log switch를 일으킨 후 checkpoint를 일으킨 다음에 다시 SBSB2 쪽으로 가서 
    select name from v$datafile; 을 하면 
    archive log file이 넘어간 것을 확인할 수 있다.
    ⇒ 즉, 안되었을 경우 archive log file을 만든 것 
    
    - shm db로 이동 후 수행
    
    [SBDB2:~]$ shm
    [shm:~]$
    [shm:~]$ sqlplus / as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:43:04 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    shm SYS >
    shm SYS > alter system switch logfile;
    
    System altered.
    
    shm SYS > alter system checkpoint;
    
    System altered.
    
    shm SYS >
    shm SYS > exit
    Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    [shm:~]$
    [shm:~]$ sbdb2
    [SBDB2:~]$
    [SBDB2:~]$ sqlplus / as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:43:33 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    SBDB2 SYS >
    SBDB2 SYS > select name from v$datafile;
    
    NAME
    --------------------------------------------------------------------------------
    /home/oracle/SBDB2/disk1/system01.dbf
    /home/oracle/SBDB2/disk2/sysaux01.dbf
    /home/oracle/SBDB2/disk4/undotbs01.dbf
    /home/oracle/SBDB2/disk2/ts900.dbf
    
    ~~~~~~~~~~~~~~~~~~~~~~~~ 실습 ~~~~~~~~~~~~~~~~~~~~~~~~~~
    
    shm SYS > create tablespace ts9000
      datafile '/u01/app/oracle/oradata/shm/disk2/ts900.dbf' size 10m;  2
    
    Tablespace created.
    
    shm SYS > select name from v$datafile;
    
    NAME
    --------------------------------------------------------------------------------
    /u01/app/oracle/oradata/shm/disk1/system01.dbf
    /u01/app/oracle/oradata/shm/disk2/sysaux01.dbf
    /u01/app/oracle/oradata/shm/disk4/undotbs01.dbf
    /u01/app/oracle/oradata/shm/disk2/ts900.dbf
    
    shm SYS > exit
    Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    [shm:~]$
    [shm:~]$ sbdb2
    [SBDB2:~]$
    [SBDB2:~]$ sqlplus / as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:41:29 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    SBDB2 SYS >
    SBDB2 SYS > select name from v$datafile;
    
    NAME
    --------------------------------------------------------------------------------
    /home/oracle/SBDB2/disk1/system01.dbf
    /home/oracle/SBDB2/disk2/sysaux01.dbf
    /home/oracle/SBDB2/disk4/undotbs01.dbf
    
    SBDB2 SYS >
    SBDB2 SYS > select process, status from v$managed_standby;
    
    PROCESS   STATUS
    --------- ------------
    ARCH      CONNECTED
    ARCH      CONNECTED
    ARCH      CONNECTED
    ARCH      CLOSING
    MRP0      WAIT_FOR_LOG
    RFS       IDLE
    RFS       IDLE
    
    7 rows selected.
    
    SBDB2 SYS > select process, status from v$managed_standby;
    
    PROCESS   STATUS
    --------- ------------
    ARCH      CONNECTED
    ARCH      CONNECTED
    ARCH      CONNECTED
    ARCH      CLOSING
    MRP0      WAIT_FOR_LOG
    RFS       IDLE
    RFS       IDLE
    
    7 rows selected.
    
    SBDB2 SYS > exit
    Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    [SBDB2:~]$
    [SBDB2:~]$ shm
    [shm:~]$
    [shm:~]$ sqlplus / as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:43:04 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    shm SYS >
    shm SYS > alter system switch logfile;
    
    System altered.
    
    shm SYS > alter system checkpoint;
    
    System altered.
    
    shm SYS >
    shm SYS > exit
    Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    [shm:~]$
    [shm:~]$ sbdb2
    [SBDB2:~]$
    [SBDB2:~]$ sqlplus / as sysdba
    
    SQL*Plus: Release 11.2.0.1.0 Production on Thu Mar 14 18:43:33 2024
    
    Copyright (c) 1982, 2009, Oracle.  All rights reserved.
    
    Connected to:
    Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - Production
    With the Partitioning, OLAP, Data Mining and Real Application Testing options
    
    SBDB2 SYS >
    SBDB2 SYS > select name from v$datafile;
    
    NAME
    --------------------------------------------------------------------------------
    /home/oracle/SBDB2/disk1/system01.dbf
    /home/oracle/SBDB2/disk2/sysaux01.dbf
    /home/oracle/SBDB2/disk4/undotbs01.dbf
    /home/oracle/SBDB2/disk2/ts900.dbf
    ```
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2040.png)
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2041.png)
    
    ![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%80%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%2092ef2911605a44959cb941cb36ff740f/Untitled%2042.png)
    
    > **LNS (Logwrite network Server)** ~> 리두를 standby db 의 RFS 에게 보낸다
    
       Primary  db  ---------------------> Standby  db
    
      ARCH                                  ARCH
      LGWR                                  RFS
      LNS                                   MRP
    >